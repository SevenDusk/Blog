# Teleportation

## 题目大意

给定二维坐标系下的n个点，求出至少需要多少种向量使得，对于任意两个点来说可以用其中一个向量走到另一个点
$$
n\leq 500
$$

## 算法讨论

首先枚举这两个点$i,j$，然后求出i到j的向量$(d_x,d_y)$

然后由于需要最小化向量个数，那么我们将向量化至最简，就是将两维的最大公约数除掉，得到的新向量放到map中

然后答案就是map中元素个数

# Just one

## 题目大意

给定n个点m条边的无向图，现在要给所有边定向，使得每一个点恰好只有一条出边，求出方案数

## 算法讨论

首先考虑图中的一个连通块

由于每一个点只需要一条边，那么联通块中的边数一定需要等于图中的点数，否则方案数就是0

由于n条边的图是基环树，那么我们将环的定向翻转得到新的方案，那么一个联通块的方案数为2，将所有联通块的方案数乘起来即可

# **Score of Permutations**

## 题目大意

对于一个排列P其代价$s(P)$定义为

对于一个初始排列$q$，令$q'_i=p_{q_i}$，直到所有的$q_i=i$，$s(P)$为操作次数

求$\sum\limits_{P} (s(P))^k$
$$
n\leq 50
$$

## 算法讨论

首先$s(P)$等于将$i$连向$p_i$形成图中所有环大小的lcm，因为对于一个环来说，需要进行环大小的倍数次操作才可以是环上的每一个数放到正确的位置，那么对于所有环大小的公共倍数就是lcm

注意到这个贡献只跟环的大小有关，与环上有哪些数是无关的，那么我们可以枚举n的所有拆分，状态总数是n的拆分数大小，n=50的时候大概为十万数量级

那么现在就知道了每一个环的大小，那么其lcm就可以算出来，接下来要算的是将数字分配到环上的方案数，假设环大小为$a_1,a_2,...,a_m$，同一个环大小出现的次数$b_1,b_2,...,b_k$

那么方案数就是
$$
\binom{n}{a_1,a_2,...,a_m}\frac{1}{b_1!b_2!...b_k!}\prod (a_i-1)!
$$
第一项是将所有数分配到环上，由于这样相同长度的环默认就是不同的，那么我们需要除以排列数使得其变得无序，然后对于环内分配就是圆排列的方案数

贡献再乘上lcm即可

### Solution 2

也可以不用拆分数枚举，我们可以将LCM的值记录到DP状态里面，由于n只有50，那么最大的LCM并不大

考虑设$dp(i,j)$表示当前所有环的大小和为$i$，其中所有环的lcm为$j$的方案数

然后我们枚举下一个环的大小$k$，然后需要将数分配到这个环上，那么需要强制当前最大的数放到这个环上，否则如果存在相同大小的环就会算重

那么$dp(i,j)\binom{i+k-1}{k-1}(k-1)!\rightarrow dp(i+k,lcm(j,k))$

直接转移即可

https://atcoder.jp/contests/abc226/submissions/27097161

# The baggage

## 题目大意

现在有1,2,3,4,5大小的球个数为$A_i$，有1,2,3,4,5大小的盒子个数为$B_i$，求盒子是否可以装下所有的球

## 算法讨论

首先判断盒子总体积需要大于等于球的总体积

对于大小$\geq 3$的球一个盒子最多只能装下一个球，并且剩下的空间都是$\leq 2$的，由于已经判断总体积合法，那么我们只需要在放$\geq 3$的球时候，尽可能的空出大小为2的盒子

首先大小为5的球只能放到大小为5的盒子中

然后大小为4的先尽量放到大小为4的盒子中，然后如果剩余那么放到大小为5的盒子中，然后将放入4球的5盒子变为1

然后大小为3的球按照3,5,4的顺序尽量进行放置

过程中如何出现不够放的情况就是直接判断不合法

然后只需要判断2是否可以放下即可
$$
A_2\leq B_2+B_3+2B_4+2B_5
$$

# **Random Kth Max**

## 题目大意

现在有n个随机变量$X_i$，其中$X_i$在区间$[L_i,R_i]$中随机一个整数，求n个变量中第k大的期望
$$
n\leq 50\\
0\leq L_i<R_i\leq 100
$$


## 算法讨论

### Solution 1

将整个值域拆分成若干长度为1的区间，那么根据期望线性性，将所有第k大值在这个小段中的期望求和就是答案

那么只考虑其中一段的情况$[p,p+1]$

由于要对第k大计数，那么我们考虑min-max容斥
$$
kthmax(S)=\sum_{\varnothing\not=T\subseteq S}(-1)^{|T|-k}\binom{|T|-1}{k-1}\min(T)
$$
我们对于所有$[L_i,R_i]$包含这个区间的定义$f_i(x)=\frac{R_i-x}{R_i-L_i},g_i(x)=\frac{x}{R_i-L_i}$

其中$f_i(x)$代表含义为当且这个变量大于x的概率，其中$g_i(x)$表示强制这个区间选择当前x，产生的贡献

那么我们需要对于任意的$T$求出其中元素多项式的乘积（其中必须仅有一个为$g_i(x)$）

假设得到的多项式为$F(x)$

那么其实际期望就是
$$
\int_{p}^{p+1} F(x)dx=(\int F)(p+1)-(\int F)(p)
$$
那么我们可以用DP求出同一个大小的$T$对应的多项式之和，然后按照上面的贡献计算即可

其中DP的值就是一个多项式，至于多项式乘法直接暴力实现即可（因为其中有一项次数只有1）

时间复杂度$O(n^3\max R_i)$

### Solution 2

前面的过程类似，都是拆成长度为1的段进行考虑

首先需要考虑一个简单一点的问题，对于所有n个变量来说其范围都是$[0,1]$求出其中第k大的期望

同样考虑答案大于等于x的概率
$$
F(x)=\sum\limits_{i=k}^n\binom{n}{i}(1-x)^ix^{n-i} 
$$
那么期望为
$$
\sum\limits_{i=k}^n \binom{n}{i}\int_{0}^1 (1-x)^ix^{n-i}dx
$$
其中根据归纳可以证明
$$
\int_{0}^1 (1-x)^ix^{n-i}dx=\frac{i!(n-i)!}{(n+1)!}
$$
那么$E=1-\frac{k}{n+1}$

最终式子比较简洁，对于区间$[p,p+1]$，我们设$dp(i,j,k)$表示考虑到第i个变量，其中有j个变量大于$p+1$，k个变量在区间$[p,p+1]$中的方案数

那么就可以将问题转化为在k个变量中第$K-j$大的期望值

[Submission #27089393 - AtCoder Beginner Contest 226](https://atcoder.jp/contests/abc226/submissions/27089393)

