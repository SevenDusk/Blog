# Too Many Impostors

## 题目大意

交互题，现在有一个0/1序列，其中0的个数$k$，满足$\frac{n}{3}<k<\frac{2n}{3}$，现在每一次可以询问$a,b,c$，返回a,b,c中出现次数较多的数

在不超过$n+6$次操作中确定所有0的位置，保证$3|n$

## 算法讨论

首先可以发现的是，题目特殊强调了$3|n$，而且$\frac{n}{3}<k<\frac{2n}{3}$，那么1的个数范围也是在这个范围之内的

那么根据鸽巢原理，可以知道如果将所有n个位置每三个分成一段，那么至少存在一段0出现了至少两次，至少存在一段1出现了至少两次

然后可以发现的是，一旦我们确定了一对0和1的位置x,y，那么对于剩下的位置来说，询问x,y,i得到的结果就是i位置上的数

那么先暴力找出0占多数的段和1占多数的段$[i,i+2],[j,j+ 2]$，首先取其中$i,j$，然后用这两个位置询问这两个段中其他所有位置，如果询问出来的结果都是相同的，那么说明$i,j$位置上的数是相同的

由于0占多数的情况只有000/001两种情况，那么如果询问出来的结果是1，那么说明i位置上是1，那么只需要将i增加1就是得到0的位置了，如果是0，将j增加1即可

那么现在得到了0/1的位置x,y，然后再确定这两段其他位置即可，这里在这两段上最多需要询问12次，是可以压成10次，但都能通过

然后考虑其他段的情况，如果当前枚举的段在之前找0/1多数段的时候没有询问过，那么直接询问段中三个数即可

如果询问过，那么我们只能用2次操作确定这个所有位置上的数

如果之前询问的整段0较多，那么有以下四种可能，000，001，010，100，如果在询问两次，可以得到的不同情况也是4次，假设这个区间为$[i,i+2]$，那么询问$a=(i,i+1,y),b=(i+1,i+2,y)$，y是表示0 的那个确定位置

如果$a=1,b=1$那么就是010，$a=0,b=1$那么就是001，如果$a=1,b=0$那么就是100，如果$a=0,b=0$那么就是000

对于整段1较多的情况也是类似的

总的操作数恰好是$n+6$次

Best code **Vercingetorix** https://codeforces.com/contest/1617/submission/139500828

# Christmas Chocolates

## 题目大意

给定一个长度为n的序列，其中需要选出任意两个不同位置的数$(x,y)$

然后每一次可以选出一个$k$，满足$2^k\geq x$，然后令$x=2^k-x$，不断进行操作，直到于y相同

求在所有数对中最小操作数的最大值

## 算法讨论

首先对于这两个数来说，对x操作和对y操作都不会影响答案

首先如果是按照操作不断变大，假设$p$是最小的$2^p\geq x$，那么对于更大的k来说，增加的都是2的次幂，如果用更大的k进行操作可以满足目标，那么用$2^p$进行操作也一定可以满足，因为两边x,y是可以抵消的，那么我们可以对于序列中每一个数，求出其不断进行操作得到的序列

可以发现的是，每一次进行操作的时候，都会将x的最高位变成1，那么x最多经过$\log x$次操作就会变成0

假设这个序列为$s_i$

那么对于两个位置$i,j$，其最小步数就是找到一个$s_i,s_j$都出现且最大的数，然后两个数都往那个相同的数进行操作，由于操作可逆，这样做一定是合法的

可以发现的是，如果存在一个相同的位置，$s_i,s_j$之后所有数都是相同的，那么答案相当于就是$|s_i|+|s_j|-2LCS(s_i,s_j)$

然后我一开始的做法就是对于所有$s_i$的所有后缀进行Hash，然后枚举$s_i$的后缀k，找到这个长度后缀不相同的$|s_j|$的最大值，那么$LCS(s_i,s_j)\leq k$，那么对答案取$|s_i|+|s_j|-2k$即可，这个需要线段树维护

但是事实上并不需要这么麻烦，可以发现存在$s_i,s_j$后缀都相同的原因就是$i$经过操作得到的数是唯一的，那么如果将$i$连向操作之后得到的数，那么形成的图就一定是一颗树，那么两个位置所需的操作数，就是这两个位置对应数节点在树上的路径长度

由于这个树最多只有$O(n\log n)$个节点，那么我们可以直接建出这个树，然后求出这个树的直径即可

时间复杂度$O(n\log n)$

Best Code:**antontrygubO_o**  [Submission #139575158 - Codeforces](https://codeforces.com/contest/1617/submission/139575158)

