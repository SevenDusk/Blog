# 1004模拟赛[211004 Match - HaltOJ](http://haltoj.top:8888/d/haoba/p/31)

# A.Match

## 题目大意

![20211004](D:\Blog\image\20211004.PNG)

## 算法讨论

首先由于队伍跟编号有关，那么我们就需要求出对于每一个位置$i$，在$[1,i-1]$区间内有$j$个晋级的概率，显然这里还需要处理一个后缀

然后考虑具体如何来做，首先我一开始想到的是直接枚举第$i$个人的分数$v$，但是这样进行DP只能统计分数比i大的人，对于比分数比$i$低的人，无法确定是否晋级

然后这一条路是没法走下去的，然后我想枚举晋级分数$v$，但是需要注意的是，当确定晋级分数的时候，实际上的晋级的人分数最低必须要是$v$，以确保不会算重

然后由于还有“如果出现分数相同的情况，则编号更小的选手优先晋级”这个限制，那么晋级的人中需要至少有一个人的分数为$v$，并且分数为$v$且晋级的人编号需要小于分数为$v$没有晋级人的编号，**考虑将这两个条件用一维表示出来**，那么我们需要特殊考虑最后一个人的分数$v$且晋级的人，满足这个条件的人一定需要存在，并且其之后不能出现分数为$v$的人

那么设$pre_{i,j,0/1}$表示考虑到前$i$个人，确定晋级了$j$个人，是否出现了最后一个分数为$v$且晋级的人

如果记$f(v,i)$表示第$i$个人分数$\geq v$的概率
$$
pre_{i,j,0}=pre_{i-1,j,0}(1-f(v,i))+pre_{i-1,j-1,0}f(v,i)\\
pre_{i,j,1}=pre_{i-1,j,1}(1-f(v+1,i))+pre_{i-1,j-1,1}f(v+1,i)+[l_i\leq v\leq r_i]pre_{i-1,j-1,0}\frac{1}{r_i-l_i+1}
$$
其中最后一个转移就是强制当前第$i$个人是最后一个分数为$v$且晋级的人

然后同时我们需要处理出后缀的DP数组，$suc_{i,j,0/1}$定义同样

然后枚举每一个人$i$，然后枚举其前面晋级了多少人$j$，假设当进入了$id$，然后就可以通过合并这两个DP，得到概率贡献

**坑点：注意印在第二页的数据范围$0\leq l$，那么$v$需要从$0$开始枚举，比赛时候从1开始枚举了，一个字符之差，$100\rightarrow  50$**

# B.Matrix

## 题目大意

![20211004T2](D:\Blog\image\20211004T2.PNG)

## 算法讨论

**首先考虑当确定$R,G,B$颜色的数量时候，如何计算本质不同的链数**

可以发现，如果链不是一个回文串的话，那么进行一次翻转一定是对应了一个不同的串，如果是回文串的话，那么翻转之后还是对应着自己，那么答案就是（总的方案数+形成了回文串的方案数）/2，显然回文串只需要考虑前一半的串即可，两者本质相同

更具体地来说，考虑颜色数量分别为$R,G,B$

- $R,G,B$都是偶数或者存在一个奇数的情况，那么总的方案数就是$\binom{R+G+B}{R,G,B}$，那么记$R'=R/2,G'=G/2,B'=B/2$，均为下取整，回文串的方案数就是$\binom{R'+G'+B'}{R',G',B'}$

- 如果$R,G,B$存在两个以上奇数的话，不存在回文串

如果我们可以求出哪些颜色数量三元组$(R,G,B)$是可以得到的，答案就有了一个比较简洁的表达式，接下来考虑哪些三元组合法

当确定两个子矩阵的时候，记内部颜色数为$(a,b,c)$，那么对于任意的$R\leq a,G\leq b,B\leq c$来说都是合法的，那么可以发现选择尽可能大的子矩形是一定包含边长比较小的情况的，那么我们只需要考虑边长为$\min(n,k),\min(m,k)$的所有子矩形，总共有$O(n^4)$对，每一对都可以$O(1)$算出$(a,b,c)$

直接这样枚举合法$(R,G,B)$是$O(n^6)$的，考虑优化，**我们可以枚举其中两维，看第三维是否可以通过前缀和或者组合恒等式转化为$O(1)$计算的式子**
$$
\begin{align}
&\sum\limits_{B=0}^{lim} \binom{R+G+B}{R,G,B}\\
&=\binom{R+G}{R}\sum\limits_{B=0}^{lim}\binom{R+G+B}{B}\\
&=\binom{R+G}{R}\binom{R+G+lim+1}{lim}
\end{align}
$$
其中最后一步是平行求和法，那么我们如果知道了$B$的上限$lim$，就可以$O(1)$的进行计算了，对于$B$的上限显然可以通过二维后缀max来实现

最后还需要考虑一下回文串的贡献，那么需要分类讨论一下$R,G$的奇偶性，以及$B$奇偶性对应的上限

**坑点：当$lim=0$的时候不能计算当$B$为奇数的贡献，而带入$lim'=\lfloor \frac{lim-1}{2}\rfloor $计算是多算了，就少了一个if判断，$100\rightarrow 40$**

# C.Memory

## 题目大意

![20211004T3](D:\Blog\image\20211004T3.PNG)

## 算法讨论

乱搞题

首先可以枚举精度$p_0,p_1$，然后求出合法的$s_0,s_1,s_2$，步长可以设为$10^{-5}$，那么做出i道题的概率就为$\binom{k}{i}p_0^i(1-p_0)^{k-i}$，那么可以通过$O(k^2)$算出$s_0,s_1,s_2$

其中由于$s_0,s_1,s_2$最多只有两位小数，那么计算出来的值误差不能超过$10^{-2}$，具体实现可以比较$|round(x)-x|$的差

那么将所有情况打表出来发现当$s_0$固定的时候，$s_1$如果大于某一个定值的时候，所有取值都是合法的，反之都是不合法的

那么我们可以对于每一个二元组$(s_0,k)$求出这个阈值，打表输出即可

当然也可以不打表，可以进行二分

还可以发现，当$s_0$递增的时候，阈值是凸的，那么可以三分求出极值