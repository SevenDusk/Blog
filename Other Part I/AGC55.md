# ABC Identity

## 题目大意

给定一个长度为$3\times n$的字符串，其中包含n个A，n个B，n个C，现在要求将这个字符串划分不超过6个子序列，使得每一个子序列都是好的

一个字符串是好的，当前仅当其长度为3的倍数，并且$T_1=T_2=...=T_k,T_{k+1}=T_{k+2}=...=T_{2k},T_{2k+1}=T_{2k+2}=...=T_{3k}$

构造划分方案

## 算法讨论

首先将序列分成三段，每一段长度为n，然后我们如果可以在三段中找到三个不同的字符，并且将所有字符都这样放到一个三元组里面

那么我们就可以按照ABC的排序进行分组，对于同一组就是一个子序列，由于ABC的排列为6个，那么这样划分一定可行

那么剩下的就是需要将所有字符放到这样的三元组里面，一个暴力的想法是，枚举ABC的每一个排列，然后将形成这个排序的三元组，全部去掉，对于所有排列重复这个过程

可以发现这样一定可以将所有位置分到三元组里面，考虑反证法，就是如果存在剩下的字符没有分到三元组里面，那么首先剩下A,B,C的数量相同，并且每一段剩下的字符相同，显然我们可以找到一个合法三元组

# ABC Supremacy

## 题目大意

给定一个长度为n个字符串，字符串中只包含$A,B,C$，现在可以选择一个长度为3的子串ABC,BCA,CAB，然后将其替换成ABC,BCA,CAB中任意一个，现在给定两个字符串，问是否可以通过若干次操作，使得两个字符串相同

## 算法讨论

首先注意到，如果将$A$看作0，$B$看作1，$C$看作2，那么对于可以进行操作的ABC,BCA,CAB相邻的两个数字在模3意义下相差1，前面+1=后面

比赛的时候我一直想将两个位置进行差分，然后相当于每一次选择11然后对于前后进行加减，**但是这样我没有找到一个在进行操作过程中不变的量，主要还是操作比较复杂还需要进一步简化**

如果我们可以将ABC,BCA,CAB变成AAA,BBB,CCC的话操作会简单很多

那么我们将$a_i=s_i-A$，然后令$a_i'=(a_i-i)\bmod 3$，那么我们可以操作的长度为3的子串就为000,111,222

然后我们需要发现，如果某一个位置上存在$000,111,222$，那么左右两边的数可以任意穿过这三个位置，那么如果我们将这三个位置删除，并不影响余下的操作

如果我们将初始中的s的所有连续3段删除，剩下的数是在操作过程中不变的，那么相当于得到剩下的位置形成的字符串就是s在操作中不变的量

可以发现的是无论按照什么顺序删除这3段，最终得到的字符串是相同的，我们一开始可以将211122这种类型的串变成111222，那么任意三个连续的串都是不交的，那么我们最终得到的串是唯一的

那么我们对于s,t都进行这样的操作，如果结果相同，那么答案就是yes，否则答案为no

# Weird LIS

## 题目大意

给定n,m求出有多少个长度为n的序列A满足以下条件

- $A_i\in [2,m]$
- 存在一个长度为$n$的排列$p$，使得对于每一个$i\in [1,n]$满足$p_1,p_2,...,p_{i-1},p_{i+1},...,p_n$的最长上升子序列长度为$A_i$

## 算法讨论

首先A中任意两个元素的差一定$\leq 1$，我们先不考虑A中所有数都相同的情况（这个情况是简单的），只考虑存在相差1的情况

首先假设$A$中最大的值为$k$，那么说明完整的$p$的LIS长度为$k$，而对于$A$中为$k-1$的位置，说明所有的LIS都是经过$p_i$的，所以在删除这个位置之后LIS的长度会$-1$

假设我们不考虑$LIS=k$的这个限制，只考虑对于所有$A_i=k-1$的位置，是否可以构造一个排列的LIS都是经过$p_i$的，显然是可以的，我们可以钦定$A_i=k-1$的位置上的数形成的是一段区间，并且是递增的，然后对于之间间隔的位置，填入大于这段区间的数就不会影响LIS的长度了，具体来说

- 首先考虑开头结尾都是$A_1=A_n=k-1$的情况，假设$A_i=k-1$的个数为$x$，并且其集合为$s$，那么我们令这些位置的数在$[1,x]$的区间内，对于$A_i=k$的位置都填入$>x$的数
- 然后考虑如果$A_1=k$，那么我们将$p_1=n$，如果$A_n=k$，那么我们将$p_n=1$，这样显然不会影响LIS，然后递归考虑中间的位置

然后我们还需要将$LIS=k$这个限制加上，会发现如果我们只用$A_i=k-1$来形成LIS可能长度不够（也可能超过k了）

首先如果$A_i=k-1$的个数$>k$，显然这个序列是不合法的

只考虑$A_i=k-1$的个数$cnt\leq k$的情况，那么对于$A_i=k$的位置还需要贡献$k-cnt$长度的上升序列，由于对于$A_i=k$的位置删除这个位置，LIS长度不变，那么说明存在一个位置$j$可以替代这个位置$i$，那么显然$A_j=k$，并且i，j之间位置都是$=k$的

那么我们将所有极长连续$A_i=k$缩成一段，我们可以将这段分成若干长度$\geq 2$的小段，对于一个小段，就是作为LIS的一个长度（位置）

对于一个小段来说同样可以看作$k-1$的情况，按照上面的进行构造，然后将填到这个小段中的数展开成一段区间即可

然后对于长度$=1$的段，就是看作上面构造过程的$A_i=k$的位置进行处理

那么原来序列的极长连续段长度为$b_1,b_2,...$

那么LIS长度的区间范围就是$[cnt,cnt+\sum \lfloor \frac{b_i}{2}\rfloor ]$，只要$k$在这个区间即可

由于只跟连续段的长度有关，那么我们就可以开始计数了，我们先枚举$A_i=k-1$的个数$i$，那么$A_i=k$的个数为$n-i$，我们枚举其中长度为奇数的段个数$x,x\equiv n-i(\bmod 2)$，那么得到的范围就是$[i,i+\frac{n-i}{2}]$，需要注意的是k的下界至少为3，上界为m，那么得到区间需要与$[3,m]$取交，记作$[l,r]$

至于方案数，考虑先将$A_i=k-1$排好，相当于连续段要放在$i+1$个空隙中，那么首先将奇数的位置放入，然后剩下$\frac{n-i-x}{2}$个2随意放到$i+1$个空隙中（就是球同盒不同可空，插板法即可），就是一组方案
$$
\binom{i+1}{x}\binom{i+\frac{n-i-x}{2}}{i}(r-l+1)
$$
直接枚举时间复杂度$O(n^2)$

最后考虑$A_i$中所有数相同的情况，显然除了$A_i=n-1$的情况下$A_i=k-1$，其他情况都是$A_i=k$，那么只需要$A_i\leq \lfloor \frac{n}{2}\rfloor$就是一组合法的序列

最终的式子为
$$
\sum\limits_{i=2}^m [i\leq \frac{n}{2}\or i=n-1]+\sum\limits_{i=2}^m \sum\limits_x \binom{i+1}{x}\binom{i+\frac{n-i-x}{2}}{i}(r-l+1)
$$
时间复杂度$O(n^2)$

