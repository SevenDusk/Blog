# Trader Problem

## 题目大意

现在手上有$n$个物品，价值为$a_i$，对方手上有$m$个物品，价值为$b_i$

现在有q个询问，每一个询问有一个参数$k$，表示当前手上物品价值为$x$可以换取对方手上价值不超过$x+k$的任何一个物品，求最终可以获得的最大物品价值和
$$
n,q\leq 2*10^5
$$

## 算法讨论

首先将所有的物品放到一起按照价值进行排序记作$c_i$，来源记作$o_i$

可以发现的是，对于物品$i<j$

如果满足
$$
\min \limits_{k=i+1}^j c_k-c_{k-1}\leq k
$$
那么我们可以不断通过将$i$与$i+1$进行交换，从而使$i$变成$j$（如果中途遇到了原本自己手上有的物品，那么可以直接跳过）

那么可以发现的是，如果将可以交换的物品之间连边，形成的联通块一定是一个完全图，并且在原物品序列中是一段区间

对于一个联通块来说，如果存在$cnt$个原来初始时候手上存在的物品，那么显然在结束的时候，这$cnt$个物品会被换成这个联通块中最大的cnt个物品

那么我们将所有询问按照$k$从小到大进行排序，然后维护$c_i-c_{i-1}$的值，将$c_i-c_{i-1}\leq k$都加入，就是将两端的联通块区间合并得到一个新的联通块区间

需要维护处物品序列的前缀和，以及来源的前缀和即可

需要用set维护联通块区间的端点，然后在删除某一个间隔$c_i-c_{i-1}$在set中查询前驱后继，然后进行合并即可

至于合并区间可以不同并查集，直接在维护的答案中删除原来两个联通块的贡献，然后加上新的联通块的贡献即可

时间复杂度$O(n\log n)$