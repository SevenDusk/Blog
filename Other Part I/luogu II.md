# P1054 [NOIP2005 提高组] 等价表达式

## 题目大意

给定一个标准算式，其中包含唯一的变量$a$，再给出$n$个算式（包含括号，加减法，乘法，乘方），同样包含唯一的变量$a$​​，求出有哪些算式是跟标准算式等价的，并且保证乘方的指数是1到10的正整数

表达式长度$\leq 50$，$n\leq 26$

## 算法讨论

会发现跟一般的表达式求值不同的是，这里会有变量，那么结果就是关于$a$的多项式，当然直接将多项式算出来很麻烦，注意到多项式的最高次不会超过10，那么不妨代入11个数值，求出点值，如果这个11个点值都相等，那么就可以说明两个算式等价，当然结果可能很大，那么需要取模，如果双模，冲突的概率就很小

那么剩下的就是表达式求值了

我们可以先给所有的运算符标一个优先级，由于有括号，需要记录一下前缀有多少个没有匹配的左括号，假设有$cnt$个
$$
+/- \leftarrow 3*cnt\\
* \leftarrow 3*cnt+1\\
a^k \leftarrow 3*cnt+2
$$
计算的时候取出当前区间优先级最小的运算符，然后将算式分成若干段，然后分治下去进行计算，将每一段的答案合并，需要注意走到最后只剩变量或者数字的时候，需要去除左右两边多余的括号

时间复杂度$O(11nlen^2)$

第一次提交:AC

# P2421 [NOI2002] 荒岛野人

## 题目大意

给出n个人，每一个人有初始位置$c_i$，每一年移动的洞穴数量$p_i$，生存的年数$l_i$，问最少需要有多少个洞穴，使得没有两个人在同一年中在同一个洞穴中，保证数据有解，并且洞穴的数量$\leq 10^6$
$$
n\leq 15,c_i,p_i\leq 100
$$

## 算法讨论

考虑枚举洞穴数量$m$，对于两个人$i,j,i\neq j$来说，如果$k$年之后会在同一个洞穴中，那么有如下等式
$$
\begin{align}
c_i+kp_i &\equiv c_j+kp_j\ (\bmod m)\\
c_i-c_j &\equiv (p_j-p_i)k\ (\bmod m)
\end{align}
$$
如果这个方程无解或者最小的$k\leq \min(l_i,l_j)$，那么是合法的

首先考虑无解的情况，当$(c_i-c_j,p_j-p_i,m)=1$时，$(p_j-p_i,m)\neq 1$，那么一定无解

那么首先需要对于三个变量，除去$(c_i-c_j,p_j-p_i,m)$​，然后判断

那么等价于判断$(c_i-c_j,p_j-p_i,m)=(p_j-p_i,m)$，如果等号成立，那么方程有解

如果有解，那么$(c_i-c_j)(p_j-p_i)^{-1}\equiv k\ (\bmod m)$

其中$(p_j-p_i)^{-1}\equiv (p_j-p_i)^{\varphi(m)-1}\ (\bmod m)$

需要注意常数，可以预处理出0到100的所有gcd，然后预处理欧拉函数，最后只需要一个快速幂就可以了

复杂度$O(n^2m\log m)$

错误点：一开始忘记判$p_i=p_j$，导致求出的gcd，可能是0，去除的时候会$RE$

第一次提交:RE

# P5766 [NOI1999] 最优联通子集

## 题目大意

给定一个平面上的点集，点集满足任意两点之间有且仅有一条路径，每一个点都有点权

求一个联通子集，使得最大化点权和

## 算法讨论

事实上这个点集构成了一颗树，然后就是求树上最大联通块权值和

建树只要将所有点按照x坐标为第一关键字，y坐标为第二关键字排序，然后扫描线一遍就可以建出树来

然后考虑设$dp(i)$表示强制选$i$节点的最大权值和
$$
dp(x)=w_x+\sum\limits_{u\in son(x)} \max(0,dp(u))
$$
时间复杂度$O(n\log n)$

第一次提交:AC