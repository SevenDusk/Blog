# **D - Neq Neq**

## 题目大意

现在有$n$个球排成一列，第$i$个球上面存在数字$A_i$，现在可以选择三个相邻的球，$x<y<z$，满足$A_x\neq A_y,A_y\neq A_z$，然后将y位置上的球删除，然后将两端拼接起来，求可以达到状态数
$$
n\leq 2*10^5
$$


## 算法讨论

首先需要考虑一种比较暴力的DP，设$f(i)$表示在剩余的状态下强制选i的方案数
$$
f(i)=\sum\limits_{j=1}^{i-1} ok(j,i)f(j)
$$
其中$ok(j,i)$表示区间$[j,i]$之间的数可以通过上面这种操作删完，最终只保留$A_i,A_j$是否合法

首先最简单的情况，如果$[j,i]$中存在两个相邻的元素数字相同，那么说明一定不能删去

那么接下来需要考虑的情况就是任意两个相邻元素不同的情况，然后可以想到如果有一个一次操作使得两个元素相邻的话还是不合法的

那么就是类似1 2 1 2 1 .....这种情况是不合法的，并且长度需要$>3$，而1 2 1是合法的

那么如果区间内存在3个不同数字，那么一定是合法的，可以将所有数字删到只剩一个，之后就一定合法

回到DP上，那么原序列按照连续出现2个以上的段分段，对于每一个段来说贡献都是独立的，现在只考虑其中一段

对于每一个位置预处理出来最大的位置，使得$[last_i,i]$中至少存在三个颜色
$$
f(i)=f(i-1)+f(i-2)+\sum\limits_{j\leq \min(i-3,last_i)} f_j
$$
可以直接用前缀和优化即可，也可以用线段树优化

线段树优化 https://atcoder.jp/contests/arc128/submissions/26592326

前缀和优化 https://atcoder.jp/contests/arc128/submissions/26597312

