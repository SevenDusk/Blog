# A.欧拉子图

**考虑一条欧拉回路是可以拆成若干环，使得两个环的边之间没有相交，考虑dfs树上返祖边形成的环是无向图中所有环的基（这里的运算是异或），那么选择选择返祖边的方案恰好与选出边组成欧拉回路的方案一一对应**

那么问题就转化为了，选择若干返祖边，然后将对应环上的树边异或，最终的方案就是选择的返祖边和被异或奇数次的树边组成，求所有方案边数平方的和

考虑$x^2$的贡献相当于在方案中选出两条边的方案，答案等价于求出包含选定两条边的方案数之和

首先如果一条边会出现的在某一个方案中，至少需要有一个返祖边覆盖了这个树边，假设有$k$条，返祖边有$A$条

- 如果选出的两条边都是树边

  - 如果选出的两条边是同一条边，方案数为$2^{A-1}$
  - 如果是不同的边，经过讨论会发现，如果覆盖这条树边的返祖边集合相同，那么方案数为$2^{A-1}$，否则为$2^{A-2}$，对于如何求出返祖边集合，那么需要用集合hash，对每一条返祖边随机一个64位权值，然后树边的权值就是覆盖这个边返祖边的权值异或和（树上差分实现），假设划分出来的等价类大小为$|s_1|,|s_2|,...$

  总的方案数就是$k^22^{A-2}+\sum |s_i|^2(2^{A-1}-2^{A-2})$

- 如果选出来的两条边都是返祖边，那么方案数$A(A-1)2^{A-2}+A2^{A-1}$

- 如果选出来的两条边一条边是返祖边一条树边，假设第i条返祖边的覆盖了$len_i$条树边，并且这些树边中只被第i条返祖边覆盖的有$cnt_i$条

  - 如果选择的树边没有被第i条返祖边覆盖，方案数为$(k-len_i)2^{A-2}$
  - 如果选择的树边只被第i条返祖边覆盖，方案数为$cnt_i2^{A-1}$
  - 如果选择的树边不止被第i条返祖边覆盖，方案数为$(len_i-cnt_i)2^{A-2}$

# B.算术导数

首先记$f(n)$表示$n$的算术导数

考虑$p^k$的情况，显然$f(p^k)=kp^{k-1}$，那么由于$f(n)$一定是一个积性函数，假设$n$的质因数分解为$p_1^{r_1}...p_k^{r_k}$
$$
f(n)=(\sum\limits_{i=1}^k\frac{r_i}{p_i})n
$$
那么$\gcd(n,f(n))=p_1^{r-1}...p_k^{r_k-1}\prod\limits_{p_i|r_i}p_i$

显然如果记$g(n)=\gcd(n,f(n))$，那么$g$仍然是一个积性函数

考虑对$g$构造函数$A,B$进行PN筛

令$g=B\times A$

其中对于所有的质数$p,A(p)=g(p)=1$，那么$B(p)=0$，那么$B$函数处不为0的值位置都是powerful number

我们令$A(n)=1$
$$
\begin{align}
\sum\limits_{i=1}^n g(i)&=\sum\limits_{i=1}^n\sum\limits_{d|i} A(\frac{i}{d})\times B(d)\\
&=\sum\limits_{d=1}^n B(d)\sum\limits_{i=1}^{\lfloor \frac{n}{d}\rfloor } 1\\
&=\sum\limits_{d=1}^n B(d)\lfloor \frac{n}{d}\rfloor 
\end{align}
$$
通过递推我们求出$B(p^k)$，然后我们dfs出所有powerful number计算其$B(d)$即可

# C.最优覆盖

首先每一条路径一定是连接了两个叶子节点的，并且最开始的一条边肯定是连接直径某一个端点经过当前节点的路径

可以想到树上一条长链的底端一定是一个叶子节点，考虑长链剖分

除下第一次选择路径，其他选择路径一定是选择两条完整的长链，并且其顶上的那条轻边一定是于当前路径所形成的联通块相连

我们定义一条长链的价值为链上所有边的权值之和加上链顶上那条轻边的权值，可以注意到某一条长链的顶上的另一条长链的价值一定比当前这条长链的价值大

那么只要贪心的选取当前未选择的长链中最大的两条就一定合法

由于一开始需要选取树上两个直径端点作为根，分别算出答案，取$max$

那么对于在树上选择$y$条路径，就相当于选出前$2y-1$条价值最大的长链，但是询问需要这些选出的长链包含x的这个点，如果$x$不被包含在内，那么需要考虑调整

第一种调整方法就是自下往上找到第一个在当前选择长链中的长链，并且这条长链是x到根节点上经过的链，那么考虑将当前$x$所在的长链接上去，然后将原来长链上在连接点以下的部分去掉

第二种调整是，将一条不在$x$到根节点所经过的链，并且这条链底下不再接另外一条链的长链，将这条长链删除，然后加入当前的长链（此处也需要找到第一种调整方案中的那条链，但是不需要将连接点以下的部分去掉），考虑这条链一定需要是第$2y-1$大的链，否则第$2y-1$大的链一定是第一种调整方案中的那条链，显然第一种方案更优

那么只要将两种方案都算出来，取$max$即可