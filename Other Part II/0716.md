# B.最短路径

首先由于$k$很大，一般的通过组合意义和转下降幂的方式都是难以处理的

那么我们就可以考虑统计出$d(u,v)=t$的有序对数量

首先考虑树上的情况，可以通过点分治计算

相当于是将每一个子树内的深度多项式和所有其他子树的多项式乘起来，那么可以先统计整个分治区域的深度多项式平方，然后再依次减去每一个子树的深度多项式平方即可

那么每一个子树的计算量只和其最大深度有关，那么这样的时间复杂度就是$O(n\log ^2n)$

由于给定的图是一颗基环树，那么需要分环上的位置和环上子树内部的贡献，子树内部的贡献可以用上面所说的点分治做法

主要是环上的操作，如果是序列的话，那么通过类似的分治操作就可以解决了，同样还是先将到分治中心的所有位置多项式乘起来，然后减去多余计算的贡献

假设环上第$i$个位置的多项式为$F_i$，然后将环破环成链复制两份

普通分治可以解决的式子是$\sum\limits_{i} F_i\sum\limits_{j>i} F_j \times x^{j-i}$

记$m$表示环长$/2$下取整，而我们需要计算的式子为$\sum\limits_{i} F_i\sum\limits_{i<j\leq i+m} F_j\times x^{j-i}$

那么我们将其差分成两部分，一部分$\sum \limits_{i} F_i\sum\limits_{i<j} F_j$，另外一部分就是$\sum\limits_i F_i\sum\limits_{j>i+m} F_j\times x^{j-i}=x^m\sum\limits_{i} F_i\sum\limits_{j>i} F_{j+m}\times x^{j-i}$

那么我们可以通过平移$F$来分治计算

时间复杂度$O(n\log ^2n)$

# C.积和式/CF468F Permanent

首先需要知道在计算二分图完美匹配的数量的时候，就是通过积和式进行运算的

那么我们将需要计算的积和式对应到二分图完美匹配上去，但是注意这个二分图很多的边权都是1，那么我们可以将这个二分图的边拆成两个，1和边权-1边

那么我们就得到了两个二分图，那么相当于我们需要选出$s,t$两个全集的子集，并且要求$|s|=|t|$，然后在其中一个二分图求出这两个集合进行完美匹配的方案数，然后乘上另一个二分图这个两个集合补集进行完美匹配的方案数即可

其中一个二分图是完全二分图，并且所有边的边权都是1，那么在这个二分图上，进行大小为$|s|$的完美匹配方案数就是$|s|!$

另外一个二分图的边数只有$k$个，那么我们可以考虑枚举这个二分图选择的集合，然后求出方案数

首先这个二分图上的联通块都是独立的，那么我们可以考虑对于每一个联通块都求出关于选择集合大小的多项式，然后将每一个集合的多项式乘起来即可

对于一个联通块大小为$s$，那么至少有一边的点数$\leq \frac{s}{2}$，那么我们可以对点数小的那边进行状压，就可以做到$2^{\frac{s}{2}}\times(\frac{s}{2})^2$

还有一种做法就是，求出这个联通块的一颗生成树，然后枚举所有非树边是否为匹配边，然后对于剩下的点在树上用DP统计即可

对于一个联通块取其中计算量小的那个即可，就可以做到$O(2^{\frac{n}{3}}\times n^2)$的时间复杂度