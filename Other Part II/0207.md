# 矩阵

## 题目大意

![20220208T1](D:\Blog\image\20220208T1.PNG)

## 算法讨论

由于每一次递归下去的时候都是将左上角的那个子矩阵设为0并且每一次都是对$2^n$的矩阵进行操作，那么说明一次操作只会影响x坐标和y坐标某一二进制位的值

相当于如果存在某一个二进制位满足$x$这一位为0，$y$这一位为1，那么这个位置的数就一定为0，如果不存在这样的位那么就为1

对于题目要求的条件，那么就是求有多少个$(x,y),x\in[X,2^n-1],y\in [Y,2^n-1]$使得$(x,y),(x-X,y-Y)$同时满足上面的条件

那么考虑数位DP从低位到高位进行DP，并在过程中模拟减法的运算，那么设$dp(i,0/1,0/1)$表示DP到第i位的时候，$x-X$是否存在高位退位的情况，$y-Y$是否存在高位退位的情况

那么在转移的时候枚举x,y当前位是什么（需要避免掉不合法的情况）然后进行转移即可

由于答案最大为$3^n$次，那么需要对dp实现高精度加法，对输入的$X,Y$从10进制分解到2进制即可

时间复杂度$O(n^2)$

# 字符串

## 题目大意

![20220208T2](D:\Blog\image\20220208T2.PNG)

## 算法讨论

首先将S进行翻转，然后对S建出sam，那么相当于就是求右端点落在区间内的本质不同子串数量

那么对于一个parent树上的节点，其endpos集合如果存在$[l,r]$中的数的话，那么这个节点代表的所有子串都是可以加入到答案中的

考虑对所有询问的右端点进行扫描线，并且我们同时对于每一个节点维护在小于等于当前扫描线的情况下最大的endpos是哪个$f_x$并且对$f_x$的贡献就是代表的子串数量，同时用树状数组维护对于值域的前缀和

考虑新加入一个节点的情况，那么相当于在parent树上从这个节点出发不断走到根路径上的所有节点的$f_x$要修改，注意到在这条链上，是存在若干连通块的$f_x$是相同的，那么这就跟LCT的access操作十分类似，那么我们考虑用LCT维护这个parent树即可

同时我们在一个连通块中维护$f_x$，并将$f_x$作为一个标记下传，那么在access的过程中遇到的连通块，在树状数组上进行修改即可

然后处理询问的时候就是直接在树状数组上区间询问即可

时间复杂度$O(n\log ^2n)$

# 收费系统

## 题目大意

![20220208T3](D:\Blog\image\20220208T3.PNG)

## 算法讨论

首先由于每一条线上区域的编号是连续的并且对于同一个中转站来说，其区域编号都是相同的，那么说明我们每一步要么+1,-1,+0，那么说明过程中走过区域的编号一定是一个区间

并且答案就是区间左右端点的距离的最小值，注意到$m\leq 10^5$而询问两个点之间的最短路显然没有好的时间复杂度，但是注意到$s\leq 30$，那么可以考虑从中转站进行入手

首先如果询问的两个点在同一条线上，那么可以直接走过去，否则就一定需要经过中转站，那么一旦走到中转站上，那么本质不同的情况就只有$(ns)^2$种

由于需要维护的是一个区间，那么我们需要枚举区间左端点，考虑可能的编号情况，如果我们从一个中转站出发在另一个中转站结束，那么显然区间的端点要么是中转站的编号要么是某一条线最小区域编号，那么不妨将某一条线最小的区域编号对应的区域加入中转站集合中

那么相当于可能的端点数量为$s+n$种，那么我们可以直接枚举左端点和右端点，对于每一对点都求出在固定区间左端点的时候最小需要多少的右端点，使得这两个点直接连通，那么可以通过并查集实现

那么在处理询问的过程中，我们处理出询问点最近的两个中转站即可，枚举是走到哪一个中转站，然后需要求出过程中走过的最小编号以及最大编号，然后枚举区间左端点，求出最小右端点，计算出答案即可

时间复杂度$O(n^2s^2(s+n)^2+q(s+n)+m)$

