# A.相交弧

首先可以将答案变成在所有圆弧中选取两个的方案数减去，选取两个圆弧不相交或者互相包含的方案数，就是选取两个圆弧相交的方案数

首先考虑不相交的情况，那么我们可以枚举靠左圆弧的右端点，然后从后往前进行枚举，同时维护一下后缀同一种颜色选取两个不同的方案数，对于每一个位置乘上这个位置前面和其颜色相同的个数即可

接下来考虑互相包含的情况，相当于对于每一个圆弧求出其区间内选出两个相同颜色的不同位置方案数（颜色和圆弧的颜色不同）

有一种暴力做法就是，将所有的圆弧按照右端点进行排序，然后用树状数组求出这个区间包含了多少个区间即可（最后需要减去包含区间都是相同颜色的情况），那么这样的做法和每一种颜色出现次数有关

另外一种做法就是枚举包含的两个区间的颜色，假设颜色为$x$的区间被$y$的区间包含，记$s$表示颜色$x$每一个所在位置之前存在多少个$y$颜色的位置序列

假设$x$颜色出现在$n$个位置，颜色$y$出现在$m$个位置，那么答案就是
$$
\sum\limits_{i=1}^n \sum\limits_{j=1}^{i-1} (s_i-s_j)^2-(s_i-s_j)+(m-s_j)s_i
$$
然后通过化简，我们就可以在$O(n)$的时间内求出这个式子的答案

那么这种做法就和颜色数量有关

那么我们可以考虑根号分治，对于颜色出现数量$\leq B$，我们放到一起采用第一种做法，那么这部分的时间复杂度就是$O(nB\log n)$，对于颜色出现数量$>B$的位置，我们使用第二种做法，那么时间复杂度$O(\frac{n^2}{B})$

平衡复杂度得$O(n\sqrt{n\log n})$

# B.序列游戏

由于我们每一次都是选取一个连续段进行删除，那么我们可以考虑删除位置得极长段，这样的极长段有两种基本的组成方式

- 在其中选取一个不一定连续的子序列，并且要求这个子序列满足合法条件，然后将剩下位置的连续段分别进行求解
- 将这个连续段划分成若干个独立的小连续段，然后对每一个连续段的进行求解

那么我们可以设$dp(l,r)$表示我们删除了$[l,r]$这个极长连续段可以获得的最大代价

我们注意到合法条件本质上就是在选取一个单峰的序列，并且要求相邻的两个数绝对值之差等于1

对于第一种情况，我们可以在这个区间内进行DP，设$f(i,j,0/1)$，表示我们考虑到第$i$个位置时候选取了$j$个位置作为连续段，0/1表示当前是否到达了峰顶的最大代价

在转移过程中需要枚举下一个子序列中的位置，然后我们需要将这两个位置之间的位置视作一个连续段，用$dp$的代价进行统计

直接DP的时间复杂度是$O(n^5)$的，但是我们可以枚举$l$，然后从小到大枚举$r$，做到$O(n^4)$复杂度





