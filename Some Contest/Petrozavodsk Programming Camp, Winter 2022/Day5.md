# H. Lucky Tickets

首先需要发现一个神奇的结论，就是只有$a_i$全部相等的时候才会有非0贡献，接下来开始证明这个结论

其中假设$t_i$表示在$a_i$中数字$i$出现的次数
$$
\begin{align}
&2^0 a_1+2^1a_2+...+2^{q-1}a_q\\
&=\sum\limits_{i=0}^{q-1}2^i\sum\limits_{j=1}^n [t_j>0]j\binom{q-1}{t_1,...,t_j-1,...,t_n}\\
&=(\sum\limits_{i=0}^{q-1}2^i)(\sum\limits_{j=1}^n [t_j>0]j\binom{q-1}{t_1,...,t_j-1,...,t_n})\\
&=\sum\limits_{j=1}^n [t_j>0]j\binom{q-1}{t_1,...,t_j-1,...,t_n}\\
\end{align}
$$
然后考虑计算$(a_1+1)(a_2+2)...(a_q+q)$的部分，将其贡献拆开，记$f(i)$表示在所有$q$个数字中选出$i$个数字的乘积之和，记$g(i)$表示在1,2,...,q中选出$i$个数的乘积之和

其中$g(i)=[x^{q-i}](x+1)(x+2)...(x+q)$

事实上$(x+1)(x+2)...(x+q)\equiv x^q-x(\bmod q)$，证明的话就是考虑左右两个多项式都是首一的，并且存在q个相同的根，即$1,2,...,q$，那么说明左右两个多项式相同

那么
$$
(a_1+1)(a_2+2)...(a_q+q)=g(q-1)f(1)+g(0)f(q)=f(q)-f(1)
$$
其中
$$
f(1)=\sum\limits_{j=1}^n [t_j>0]j\binom{q-1}{t_1,...,t_j-1,...,t_n}\\
f(q)=\binom{q}{t_1,t_2,...,t_n}\sum\limits_{i=1}^n i^{t_i}=0
$$
其中$f(q)=0$的原因是，由于不存在$t_i=q$并且$q$是一个质数，那么分子上的$q$没法被约掉，那么在模q之后就是等于0了

但是如果存在$t_i=q$，那么$f(q)\neq 0$，贡献即为$i^q\equiv i$，只需要考虑所有数字相同的情况即可

